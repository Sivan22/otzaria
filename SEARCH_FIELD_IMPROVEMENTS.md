# שיפורים בשדה החיפוש המתקדם

## בעיות שתוקנו:

### 1. מחיקת אות אחת מביאה לביטול כל הסימונים
**הבעיה:** כשמוחקים אות אחת ממילה, כל אפשרויות החיפוש והמילים החלופיות נמחקות.

**הפתרון:** 
- הוספת זיהוי "שינוי קטן" vs "שינוי גדול"
- שינוי קטן (מחיקת/הוספת אות) שומר על כל הסימונים
- שינוי גדול (מחיקת/הוספת מילה שלמה) מבצע מיפוי חכם

### 2. מחיקת מילה לפני מילה מסומנת מבטלת סימונים
**הבעיה:** כשמוחקים מילה לפני מילה שיש לה סימונים, הסימונים נעלמים כי האינדקס משתנה.

**הפתרון:**
- מיפוי מילים לפי תוכן ודמיון, לא רק לפי אינדקס
- שמירה על סימונים של מילים שנשארו זהות
- מיפוי חכם של מילים דומות

### 3. מילה חלופית "נדבקת" למילה הראשונה כשמוסיפים מילה לפניה
**הבעיה:** כשמוסיפים מילה לפני מילה עם מילה חלופית, המילה החלופית עוברת למילה החדשה.

**הפתרון:**
- מיפוי מילים לפי דמיון תוכן
- שמירה על קשר בין מילה למילים החלופיות שלה
- עדכון אינדקסים בצורה חכמה

## פונקציות חדשות שנוספו:

### `_isMinorTextChange()`
בודקת אם השינוי הוא קטן (אות אחת) או גדול (מילה שלמה)

### `_calculateWordSimilarity()`
מחשבת דמיון בין שתי מילים באמצעות אלגוריתם Levenshtein distance מפושט

### `_mapOldWordsToNew()`
יוצרת מיפוי בין מילים ישנות למילים חדשות לפי דמיון

### `_remapControllersAndOverlays()`
מעדכנת את כל ה-controllers והבועות לפי המיפוי החדש

### `_remapSearchOptions()`
מעדכנת את אפשרויות החיפוש לפי המיפוי החדש

### `_handleMinorTextChange()` & `_handleMajorTextChange()`
מטפלות בשינויים קטנים וגדולים בהתאמה

## תוצאה:
עכשיו כשמשתמש:
- מוחק אות אחת - כל הסימונים נשמרים ✅
- מוחק מילה שלמה - כל הסימונים מתאפסים (כמו שצריך) ✅  
- מוסיף מילה - כל הסימונים מתאפסים (כמו שצריך) ✅
- מוסיף/מוחק מרווח - מרווחים בין מילים נשמרים רק בשינויים קטנים ✅

## התיקון הסופי:
הבעיה העיקרית הייתה שגם בשינויים קטנים (מחיקת אות אחת), הקוד יצר SearchQuery חדש שלא שמר על אפשרויות החיפוש הקיימות. 

הפתרון:
1. זיהוי נכון של שינויים קטנים vs גדולים
2. בשינויים קטנים - שמירה ועדכון של אפשרויות החיפוש הקיימות
3. בשינויים גדולים - איפוס מלא (כמו שצריך)

## תיקון נוסף - בועות שארית:
הבעיה: כשמוחקים מילה, נשארו בועות "שארית" במיקום הקודם.

הפתרון:
1. ניקוי מלא של כל ה-overlays לפני המיפוי בשינויים גדולים
2. בדיקות תקינות במיקומי הבועות
3. הסרה אוטומטית של controllers במיקומים לא תקינים

## תיקון נוסף - בעיית הפוקוס:
הבעיה: אחרי שינוי טקסט בשדה החיפוש, הפוקוס עבר למילה החלופית וגרם למחיקה לא רצויה.

הפתרון:
1. הוספת פרמטר `requestFocus` ל-`_AlternativeField` ו-`_SpacingField`
2. בועות חדשות (כשלוחצים על כפתור +) - מבקשות פוקוס
3. בועות קיימות (כשמציגים מחדש אחרי שינוי טקסט) - לא מבקשות פוקוס

עכשיו המערכת עובדת מושלם ללא בעיות פוקוס!